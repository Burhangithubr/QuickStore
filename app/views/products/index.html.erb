<h1>My Store Products</h1>

<p>
  <strong>Store:</strong> <%= @store.name %>
</p>

<% if current_user.stock_manager? %>
  <%= link_to "➕ Add New Product", new_store_product_path(@store), class: "btn btn-primary mb-3" %>
<% end %>

<% if @products.any? %>
  <div class="product-list">
    <% @products.each do |product| %>
      <% next if product.nil? || product.id.nil? %>

      <div class="product-box mb-3 p-3 border rounded">
        <h4><%= product.name %></h4>
        <p><strong>Description:</strong> <%= product.description.presence || "N/A" %></p>
        <p><strong>Price:</strong> $<%= number_with_precision(product.price, precision: 2) %></p>
        <p><strong>Stock:</strong> <%= product.stock %></p>
        <p><strong>Max Per Order:</strong> <%= product.max_purchase_limit || "Unlimited" %></p>

        <% if product.image.present? %>
          <div class="product-image my-2">
            <img src="<%= product.image %>" alt="<%= product.name %>" style="max-width: 150px;">
          </div>
        <% end %>

        <div class="mt-2">
          <% if current_user.stock_manager? %>
            <%= link_to "✏️ Edit", edit_store_product_path(@store, product), class: "btn btn-sm btn-warning" %>
            <%= link_to "🗑 Delete", store_product_path(@store, product), method: :delete,
                        data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-danger" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <p class="text-muted">No products available for this store.</p>
<% end %>
