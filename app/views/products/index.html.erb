<% @products.each do |product| %>
  <div class="product-box">
    <strong><%= product.name %></strong> â€” $<%= product.price %><br>
    Stock: <%= product.stock %> | Max/Order: <%= product.max_purchase_limit || "Unlimited" %><br>

    <% if product.stock > 0 %>
      <%= form_with url: add_to_cart_path, method: :post, local: true do |f| %>
        <%= hidden_field_tag :product_id, product.id %>
        <%= number_field_tag :quantity, 1, min: 1, max: [product.stock, product.max_purchase_limit || product.stock].min %>
        <%= submit_tag "Add to Cart", class: "btn btn-sm btn-success" %>
      <% end %>
    <% else %>
      <p class="text-danger">Out of stock</p>
    <% end %>
  </div>
<% end %>
