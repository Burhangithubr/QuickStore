<h1>Dispatcher Order Dashboard</h1>

<%= link_to "Export as CSV", dispatcher_export_orders_path(format: :csv), class: "button" %>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');

  body {
    background: radial-gradient(ellipse at center, #0f0f0f 0%, #000000 100%);
    color: #0ff;
    font-family: 'Orbitron', sans-serif;
  }

  h1 {
    text-align: center;
    font-size: 2.5rem;
    text-shadow: 0 0 10px #0ff;
    margin-top: 30px;
  }

  .button,
  .logout-button {
    display: inline-block;
    background: linear-gradient(90deg, #ff00cc, #3333ff);
    border: none;
    color: white;
    padding: 12px 24px;
    text-align: center;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 0 20px #ff00cc;
    transition: all 0.3s ease-in-out;
    text-transform: uppercase;
  }

  .button:hover,
  .logout-button:hover {
    background: linear-gradient(90deg, #00f0ff, #ff00f7);
    box-shadow: 0 0 30px #00f0ff;
    transform: scale(1.05);
  }

  table.table {
    width: 95%;
    margin: 30px auto;
    border-collapse: collapse;
    background: #111;
    color: #0ff;
    box-shadow: 0 0 25px #0ff;
    border: 2px solid #0ff;
  }

  thead {
    background: linear-gradient(90deg, #00f0ff, #ff00f7);
    color: black;
    text-shadow: none;
  }

  th, td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #0ff;
    font-size: 14px;
  }

  tr:hover {
    background-color: rgba(0, 255, 255, 0.1);
    transition: background-color 0.3s;
  }

  .badge {
    padding: 5px 10px;
    border-radius: 8px;
    background: #ffc107;
    color: #000;
    font-weight: bold;
  }

  ul {
    padding-left: 0;
    margin: 0;
  }

  li {
    list-style: none;
    margin-bottom: 5px;
  }
</style>

<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Customer</th>
      <th>Shipping Address</th>
      <th>Status</th>
      <th>Your Total</th>
      <th>Store Name</th>
      <th>Items</th>
    </tr>
  </thead>
  <tbody>
    <% @order_items.group_by(&:order).each do |order, items| %>
      <tr>
        <td><%= order.id %></td>
        <td><%= order.customer.email %></td>
        <td><%= order.shipping_address %></td>
        <td><span class="badge"><%= order.status.capitalize %></span></td>
        <td>
          <%= number_to_currency(items.sum { |item| item.quantity.to_f * (item.product&.price || 0) }) %>
        </td>
        <td>
          <% store_names = items.map { |item| item.product&.store&.name }.uniq.compact %>
          <% store_names.each do |store_name| %>
            <p><strong><%= store_name %></strong></p>
          <% end %>
        </td>
        <td>
          <ul>
            <% items.each do |item| %>
              <li>
                <%= item.product&.name || "No Product" %>
                <span style="color: #999;">Ã— <%= item.quantity %></span>
              </li>
            <% end %>
          </ul>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= button_to "Logout", destroy_user_session_path, method: :delete, class: "logout-button" %>
